<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bingo Game</title>
<!-- Google Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=BBH+Sans+Hegarty&display=swap" rel="stylesheet">

<style>
  body {
    background-color: #121212;
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  .title {
    font-size: 3rem;
    font-weight: bold;
    margin-bottom: 30px;
  }

  .title span {
    color: white;
    transition: color 0.3s ease;
    font-family: "BBH Sans Hegarty", sans-serif;
    margin: 0 5px;
  }

  .bingo-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(5, 1fr);
    gap: 5px;
    width: 90vw;
    max-width: 500px;
    height: 90vw;
    max-height: 500px;
  }

  .bingo-grid button {
    width: 100%;
    height: 100%;
    font-size: clamp(18px, 4vw, 28px);;
    border-radius: 8px;
    cursor: pointer;
    border: solid;
    border-width : 3px;
    transition: 0.2s;
    background-color: #fff;
    color: #000000;
    border-color : black;
  }

  .bingo-grid button:hover {
    background-color: #9a9a9a;
  }

  .bingo-grid button.active {
    background-color: rgb(18, 182, 68); /*color should be better*/
    color: #fff;
  }

  /* Modal popup */
  .modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background-color: #1f1f1f;
    padding: 30px 40px;
    border-radius: 15px;
    box-shadow: 0 0 20px #FFD700;
    text-align: center;
    transition: transform 0.3s ease;
    z-index: 1000;
  }

  .modal.show {
    transform: translate(-50%, -50%) scale(1);
  }

  .modal h2 {
    color: #FFD700;
    margin-bottom: 20px;
  }

  .modal button {
    margin: 5px;
    padding: 10px 20px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
  }

  .restart-btn {
    background-color: #FFD700;
    color: black;
  }

  .restart-btn:hover {
    background-color: #e5c100;
  }

  /* Confetti behind modal */
  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    opacity: 0.8;
    animation: fall 3s linear forwards;
  }

  @keyframes fall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
  }
  #title span {
    font-weight: 900;
    text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000;
}
.grid-box {
  padding: 15px;
  border: 4px solid rgb(0, 0, 0);
  border-radius: 15px;
  background-color: #1c1c1c; /* slightly lighter than default bg #121212 */
  display: flex;
  justify-content: center;
  background-color: #1c1c1c; /* initial shade of body background */
  align-items: center;
  transition: background-color 0.3s ease; /* smooth theme change */
}


</style>
</head>
<body>

<h1 class="title" id="title">
  <span>E</span><span>N</span><span>J</span><span>O</span><span>Y</span>
</h1>

<button id="themeBtn" style="
  position:absolute; top:20px; right:20px;
  padding:10px 18px; border:none; border-radius:8px;
  background:#FFD700; color:black; font-weight:bold;
  cursor:pointer;
">Change Theme</button>

<div class="grid-box">
  <div class="bingo-grid" id="grid"></div>
</div>


<!-- Modal Popup -->
<div class="modal" id="modal">
  <h2>üéâ You Won! üéâ</h2>
  <button class="restart-btn" id="restartBtn">Restart Game</button>
</div>

<div id="celebration"></div>
<script src="/socket.io/socket.io.js"></script>
<script>


const size = 5;
const grid = document.getElementById("grid");
const buttons = [];
const titleSpans = document.querySelectorAll(".title span");
let nextLetterIndex = 0;
const completedLines = new Set();
let gameWon = false;

/* ------------------------------------
   1Ô∏è‚É£ CREATE GRID BUTTONS FIRST
-------------------------------------*/
for(let i=0;i<size*size;i++){
  const btn = document.createElement("button");
  btn.textContent = "";
  grid.appendChild(btn);
  buttons.push(btn);

  btn.addEventListener("click", () => {
  if (!btn.classList.contains("active")) {
    btn.classList.add("active"); // only activate, never remove
    checkLines();
  }
});

}

/* ------------------------------------
   2Ô∏è‚É£ LOAD SAVED THEME (MUST be here)
-------------------------------------*/
function loadSavedTheme() {
  const saved = localStorage.getItem("bingoTheme");
  if (!saved) return;

  const t = JSON.parse(saved);

  // Set page background
  document.body.style.backgroundColor = t.bg;

  // Set grid container shade (30% lighter)
  const gridBox = document.querySelector(".grid-box");
  if (gridBox) {
    gridBox.style.backgroundColor = shadeColor(t.bg, 30);
  }

  // Keep all buttons permanently white
  buttons.forEach(btn => {
    btn.style.backgroundColor = "#FFFFFF";
    btn.style.color = "#000000";
  });

  // Active buttons still highlight
  const style = document.createElement("style");
  style.innerHTML = `
    .bingo-grid button.active {
      background-color: ${t.active} !important;
      color: white !important;
    }
  `;
  document.head.appendChild(style);
}


loadSavedTheme();   // ‚¨Ö important position!



/* ------------------------------------
   NUMBER GENERATION
-------------------------------------*/
const numbers = Array.from({length:25},(_,i)=>i+1).sort(()=>Math.random()-0.5);


// Diagonal flicker reveal
function getDiagonals() {
  const diags = [];
  for (let k = 0; k < size * 2 - 1; k++) {
    const diag = [];
    for (let i = 0; i < size; i++) {
      const j = k - i;
      if (j >= 0 && j < size) diag.push(i*size + j);
    }
    if (diag.length > 0) diags.push(diag);
  }
  return diags;
}

const diagonals = getDiagonals();

function flickerButton(index, finalNumber, delay) {
  setTimeout(()=>{
    const btn = buttons[index];
    let count = 0;
    const interval = setInterval(()=>{
      btn.textContent = Math.floor(Math.random()*25)+1;
      count++;
      if(count > 10){
        clearInterval(interval);
        btn.textContent = finalNumber;
      }
    },50);
  }, delay);
}


/* ------------------------------------
   TITLE ROULETTE
-------------------------------------*/
function rouletteTitleChange() {
  const letters = document.querySelectorAll("#title span");
  const finalWord = ["B", "I", "N", "G", "O"];
  const spins = 20;

  letters.forEach((span, i) => {
    let count = 0;
    const interval = setInterval(() => {
      span.textContent = String.fromCharCode(65 + Math.floor(Math.random() * 26));
      count++;
      if (count > spins) {
        clearInterval(interval);
        span.textContent = finalWord[i];
        span.style.color = "#FFD700";
        setTimeout(() => (span.style.color = "white"), 300);
      }
    }, 50 + i * 20);
  });
}

setTimeout(rouletteTitleChange, 700);



/* ------------------------------------
   NUMBER FLICKER START
-------------------------------------*/
let numIndex = 0;
diagonals.forEach((diag, dIndex)=>{
  diag.forEach((cell)=>{
    const finalNum = numbers[numIndex++];
    flickerButton(cell, finalNum, dIndex*300);
  });
});


/* ------------------------------------
   LINES CHECK
-------------------------------------*/
function getAllLines() {
  const lines = [];
  for(let r=0;r<size;r++){
    const row = [];
    for(let c=0;c<size;c++) row.push(r*size+c);
    lines.push(row);
  }
  for(let c=0;c<size;c++){
    const col = [];
    for(let r=0;r<size;r++) col.push(r*size+c);
    lines.push(col);
  }
  lines.push([0,6,12,18,24]);
  lines.push([4,8,12,16,20]);
  return lines;
}

function checkLines() {
  const lines = getAllLines();
  lines.forEach(line=>{
    const key = line.join("-");
    if(!completedLines.has(key)){
      const isActive = line.every(i => buttons[i].classList.contains("active"));
      if(isActive){
        completedLines.add(key);
        if(nextLetterIndex<titleSpans.length){
          titleSpans[nextLetterIndex].style.color = "#FFD700";
          nextLetterIndex++;
        }
      }
    }
  });

  if(nextLetterIndex === 5 && !gameWon){
    gameWon = true;
    titleSpans.forEach(span => span.style.color = "#4CAF50");
    showWinModal();
    showConfetti();
  }
}


/* ------------------------------------
   MODAL
-------------------------------------*/
function showWinModal(){
  const modal = document.getElementById("modal");
  modal.classList.add("show");
  document.getElementById("restartBtn").onclick = ()=> location.reload();
}


/* ------------------------------------
   CONFETTI
-------------------------------------*/
function showConfetti(){
  const celebrationDiv = document.getElementById("celebration");
  for(let i=0;i<100;i++){
    const confetti = document.createElement("div");
    confetti.classList.add("confetti");
    confetti.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
    confetti.style.left = `${Math.random()*100}vw`;
    confetti.style.top = `-${Math.random()*20}px`;
    confetti.style.width = `${5 + Math.random()*5}px`;
    confetti.style.height = `${5 + Math.random()*5}px`;
    confetti.style.animationDuration = `${2 + Math.random()*2}s`;
    celebrationDiv.appendChild(confetti);
  }
}


/* ------------------------------------
   3Ô∏è‚É£ THEME CHANGER WITH SAVING
-------------------------------------*/
const themes = [
  { bg: "#FF3B30", btn: "#FFFFFF", active: "#C51110" }, 
  { bg: "#007AFF", btn: "#FFFFFF", active: "#0051A8" }, 
  { bg: "#34C759", btn: "#FFFFFF", active: "#1E8E43" },
  { bg: "#FFCC00", btn: "#FFFFFF", active: "#B38F00" },
  { bg: "#AF52DE", btn: "#FFFFFF", active: "#7A2C9D" },
  { bg: "#FF9500", btn: "#FFFFFF", active: "#C66B00" },
  { bg: "#FF2D55", btn: "#FFFFFF", active: "#B81E3A" },
  { bg: "#30D158", btn: "#FFFFFF", active: "#1C8F36" },
  { bg: "#5AC8FA", btn: "#FFFFFF", active: "#258EBF" },
  
];

document.getElementById("themeBtn").onclick = () => {
  const t = themes[Math.floor(Math.random() * themes.length)];

  // Change page background
  document.body.style.backgroundColor = t.bg;

  // Make container a distinct shade (30% lighter)
  const gridBox = document.querySelector(".grid-box");
  if (gridBox) {
    gridBox.style.backgroundColor = shadeColor(t.bg, 60);
  }

  // Keep all buttons permanently white
  buttons.forEach(btn => {
    btn.style.backgroundColor = "#FFFFFF";
    btn.style.color = "#000000";
  });

  // Active buttons still highlight
  const style = document.createElement("style");
  style.innerHTML = `
    .bingo-grid button.active {
      background-color: ${t.active} !important;
      color: white !important;
    }
  `;
  document.head.appendChild(style);

  // Save background theme
  localStorage.setItem("bingoTheme", JSON.stringify(t));
};

function shadeColor(color, percent) {
  let f=parseInt(color.slice(1),16),
      t=percent<0?0:255,
      p=percent<0?percent*-1:percent,
      R=f>>16,G=f>>8&0x00FF,B=f&0x0000FF;
  return "#" + (0x1000000 + (Math.round((t-R)*p/100)+R)*0x10000 
                     + (Math.round((t-G)*p/100)+G)*0x100 
                     + (Math.round((t-B)*p/100)+B)).toString(16).slice(1);
}
// --------------------------
// Socket.IO Multiplayer
// --------------------------
const socket = io();

socket.on('connect', () => {
  console.log('Connected to server:', socket.id);
});

// When a button is clicked, send number to other players
buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    if (btn.classList.contains('active')) {
      socket.emit('numberSelected', btn.textContent);
    }
  });
});

// When another player selects a number, show popup
socket.on('otherPlayerSelected', (num) => {
  const popup = document.createElement('div');
  popup.textContent = `Other player selected: ${num}`;
  popup.style.position = 'fixed';
  popup.style.top = '20px';
  popup.style.left = '20px';       // always on top-left corner
  popup.style.padding = '10px 15px';
  popup.style.backgroundColor = 'rgba(255, 215, 0, 0.9)';
  popup.style.color = '#000';
  popup.style.borderRadius = '8px';
  popup.style.zIndex = 10000;
  popup.style.minWidth = '200px';
  popup.style.textAlign = 'center';
  document.body.appendChild(popup);

  setTimeout(() => popup.remove(), 2000);
});



</script>


</body>
</html>

